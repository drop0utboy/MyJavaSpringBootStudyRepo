<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Backend-Rest-API</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
		crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
		crossorigin="anonymous"></script>

	<link href="/css/my.css" rel="stylesheet">
</head>

<body>
	<div class="card m-2">
		<div class="card-header">VD</div>
		<div class="card-body">
			<button onclick="ajax()" class="btn btn-info btn-sm"> Request Parameter 방식</button>
		</div>

		<script>
			async function ajax() {
				try {
					// fetch 함수는 서버 연결이 안되면 catch로 이동
					// fetch 함수는 서버 연결이 되고 400 500대 에러가 나더라도 catch로 이동하지 않음
					const response = await fetch("/validation-rest/request-parameter", {
						method: "POST",
						headers: {
							"Content-Type": "application/x-www-form-urlencoded"
						},
						body: new URLSearchParams({
							mid: "whi",
							mname: "고길동",
							mpassword: "Abc12311",
							memail: "ddd@ddd.com",
							mtel: "010-123-1234",
							mssn: "011225-1111111"
						})
					});


					console.log("response 객체:", response);
					const result = await response.json();

					// response 객체로 판단하기
					if (response.ok == true) {
						console.log(result);
						console.log("ok는 true");

					} else {
						if (response.status == 400) {
							console.log("유효성 검사 실패");
							// console.log(result);
							
							for(var i=0; i<result.errors.length; i++) {
								const field = result.errors[i].field;
								const message = result.errors[i].defaultMessage;
								console.log(field + ":" + message);
							}
							
						} else if (response.status == 500) {
							console.log("서버 응답 실패");
							console.log(result);
						}
					}
				} catch {
					console.log("서버 연결 실패" + error);
				}
			}



		</script>
</body>

</html>