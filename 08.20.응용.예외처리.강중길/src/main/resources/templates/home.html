<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>계좌 데모 (간결 UI)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <style>
    pre#log { min-height: 200px; white-space: pre-wrap; }
    .action-btns .btn { min-width: 110px; }
    .hidden { display:none !important; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4">

    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="m-0">계좌 데모</h3>
    </div>

    <!-- 1) 상단 액션 버튼 4개 -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="d-flex flex-wrap gap-2 action-btns">
          <button id="btnCreate"  class="btn btn-primary">계좌 생성</button>
          <button id="btnDeposit" class="btn btn-success">입금</button>
          <button id="btnWithdraw" class="btn btn-warning">출금</button>
          <button id="btnDelete"  class="btn btn-danger">계좌 삭제</button>
        </div>
      </div>
    </div>

    <!-- 2) 접히는 입력 영역 (선택된 버튼에 따라 필드가 달라짐) -->
    <div id="panel" class="card shadow-sm mb-3 hidden">
      <div class="card-body">
        <h6 id="panelTitle" class="mb-3">입력</h6>

        <div class="row g-3">
          <!-- 계좌번호 -->
          <div class="col-12 col-md-6">
            <label for="anoInput" class="form-label">계좌번호 (ano)</label>
            <input id="anoInput" class="form-control" placeholder="예: 111-111" />
          </div>

          <!-- 금액 (입금/출금에만 표시) -->
          <div id="amountGroup" class="col-12 col-md-6 hidden">
            <label for="amountInput" class="form-label">금액</label>
            <input id="amountInput" type="number" class="form-control" placeholder="예: 100000" />
          </div>
        </div>

        <div class="mt-3 d-flex gap-2">
          <button id="btnSubmit" class="btn btn-dark">실행</button>
          <button id="btnCancel" class="btn btn-outline-secondary">접기</button>
        </div>
      </div>
    </div>

    <!-- 3) 로그 -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="mb-2">응답 로그</h6>
        <pre id="log" class="bg-light p-2 border rounded"></pre>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-dark btn-sm" onclick="clearLog()">로그 비우기</button>
          <button class="btn btn-outline-dark btn-sm" onclick="copyLog()">로그 복사</button>
        </div>
      </div>
    </div>

  </div><!-- /container -->

  <script>
    // 엘리먼트
    const logEl        = document.getElementById("log");
    const panel        = document.getElementById("panel");
    const panelTitle   = document.getElementById("panelTitle");
    const btnSubmit    = document.getElementById("btnSubmit");
    const btnCancel    = document.getElementById("btnCancel");
    const anoInput     = document.getElementById("anoInput");
    const amountGroup  = document.getElementById("amountGroup");
    const amountInput  = document.getElementById("amountInput");

    // 현재 선택된 액션 상태: 'create' | 'deposit' | 'withdraw' | 'delete'
    let currentAction = null;

    // 로그 유틸
    function appendLog(obj) {
      try {
        logEl.textContent = JSON.stringify(obj, null, 2) + "\n\n" + logEl.textContent;
      } catch {
        logEl.textContent = obj + "\n\n" + logEl.textContent;
      }
    }
    function clearLog() { logEl.textContent = ""; }
    async function copyLog() {
      await navigator.clipboard.writeText(logEl.textContent || "");
      appendLog("✅ 로그를 클립보드에 복사했습니다.");
    }

    // 공통 POST
    async function postForm(url, params) {
      const res = await fetch(url, {
        method: "post",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(params),
      });
      const data = await res.json().catch(() => ({}));
      appendLog({ url, status: res.status, data });
      return data;
    }

    // 패널 열기/세팅
    function openPanel(action) {
      currentAction = action;

      // 타이틀/필드 표시 제어
      if (action === "create") {
        panelTitle.textContent = "계좌 생성";
        amountGroup.classList.add("hidden"); // 금액 숨김
      } else if (action === "deposit") {
        panelTitle.textContent = "입금";
        amountGroup.classList.remove("hidden");
      } else if (action === "withdraw") {
        panelTitle.textContent = "출금";
        amountGroup.classList.remove("hidden");
      } else if (action === "delete") {
        panelTitle.textContent = "계좌 삭제";
        amountGroup.classList.add("hidden");
      }

      // 입력 초기화
      if (!anoInput.value) anoInput.value = "";
      amountInput.value = "";

      // 패널 열기
      panel.classList.remove("hidden");
      anoInput.focus();
    }

    function closePanel() {
      panel.classList.add("hidden");
      currentAction = null;
    }

    // 실행 버튼 동작
    btnSubmit.addEventListener("click", async () => {
      const ano = (anoInput.value || "").trim();
      if (!ano) return appendLog("⚠️ 계좌번호(ano)를 입력하세요.");

      if (currentAction === "create") {
        await postForm("/createAccount", { ano });
      } else if (currentAction === "delete") {
        await postForm("/deleteAccount", { ano });
      } else if (currentAction === "deposit") {
        const amount = parseInt((amountInput.value || "").trim(), 10);
        if (!Number.isFinite(amount) || amount <= 0) return appendLog("⚠️ 금액을 올바르게 입력하세요.");
        await postForm("/deposit", { ano, amount });
      } else if (currentAction === "withdraw") {
        const amount = parseInt((amountInput.value || "").trim(), 10);
        if (!Number.isFinite(amount) || amount <= 0) return appendLog("⚠️ 금액을 올바르게 입력하세요.");
        await postForm("/withdraw", { ano, amount });
      } else {
        appendLog("⚠️ 동작이 선택되지 않았습니다.");
      }
    });

    btnCancel.addEventListener("click", () => closePanel());

    // 상단 버튼 핸들러
    document.getElementById("btnCreate").addEventListener("click", () => openPanel("create"));
    document.getElementById("btnDeposit").addEventListener("click", () => openPanel("deposit"));
    document.getElementById("btnWithdraw").addEventListener("click", () => openPanel("withdraw"));
    document.getElementById("btnDelete").addEventListener("click", () => openPanel("delete"));

    // 키보드 편의: Enter 입력 시 실행
    [anoInput, amountInput].forEach(el => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !panel.classList.contains("hidden")) {
          btnSubmit.click();
        }
      });
    });
  </script>
</body>
</html>
